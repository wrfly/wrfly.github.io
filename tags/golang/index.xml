<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Golang on wrfly&#39;s blog</title>
    <link>https://wrfly.kfd.me/tags/golang/</link>
    <description>Recent content in Golang on wrfly&#39;s blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <lastBuildDate>Tue, 16 Apr 2019 22:13:25 +0800</lastBuildDate>
    
	<atom:link href="https://wrfly.kfd.me/tags/golang/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>Golang-Open-File</title>
      <link>https://wrfly.kfd.me/posts/golang-open-file/</link>
      <pubDate>Tue, 16 Apr 2019 22:13:25 +0800</pubDate>
      
      <guid>https://wrfly.kfd.me/posts/golang-open-file/</guid>
      <description>å¾ˆä¹…ä¹‹å‰é‡åˆ°çš„é—®é¢˜äº†ï¼Œæ¸…ä»»åŠ¡çš„æ—¶å€™è¿™ä¸ªwriteæ’ç¬¬ä¸€ï¼Œå°±å†™ä¸€ä¸‹ã€‚
èµ·å›  è¦åšä¸€ä¸ªä¸´æ—¶çš„å‘Šè­¦ç³»ç»Ÿï¼Œåˆä¸æƒ³å¼•å…¥DBï¼Œä¹Ÿä¸æƒ³ç”¨boltï¼Œä¸æƒ³å¼•å…¥é¢å¤–çš„åŒ…ï¼Œæ‰€ä»¥å°±å‚»äº†å§å”§çš„è‡ªå·±ç”¨æ–‡ä»¶å®ç°ä¸€ä¸ªç®€å•çš„DBã€‚
ï¼ˆç°åœ¨å›æƒ³èµ·æ¥çœŸçš„å¾ˆæ²¡å¿…è¦ï¼Œè€è€å®å®ç”¨boltdbå¤šå¥½ï¼Œç®€å•å¿«é€Ÿæå¾—å®šï¼‰
æ¯ä¸€æ¡å‘Šè­¦éƒ½æœ‰è‡ªå·±çš„hashï¼Œå¦‚æœåœ¨æ–‡ä»¶ä¸­æ²¡æœ‰å‘ç°è¿™æ¡hashï¼Œåˆ™å‘é€å‘Šè­¦å¹¶å°†hashå†™å…¥æ–‡ä»¶ï¼Œå¦‚æœå‘ç°äº†åˆ™è·³è¿‡ï¼Œç›®çš„æ˜¯é˜²æ­¢é‡å¤å‘Šè­¦ã€‚
å¾ˆç®€å•çš„é€»è¾‘ï¼Œä½†bugæ˜¯ï¼Œè¿˜æ˜¯ä¼šå‘é€é‡å¤çš„å‘Šè­¦ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœè¿™æ¡å‘Šè­¦åŠå°æ—¶ä¹‹å‰å‘è¿‡äº†ï¼Œé‚£ä¹ˆåŠå°æ—¶ä¹‹åè¿˜ä¼šå†å‘ã€‚ï¼ˆç¨‹åºæ˜¯ç”¨cron jobè·‘çš„ï¼Œæ¯åŠå°æ—¶è·‘ä¸€æ¬¡ï¼ŒæŸ¥è¯¢å„ä¸ªçŠ¶æ€ï¼Œå¦‚æœæŒ‡æ ‡ä½äºé˜ˆå€¼åˆ™å‘Šè­¦ï¼‰
ç»è¿‡ ç¨‹åºçš„æŸä¸ªéƒ¨åˆ†æ˜¯è¿™æ ·å†™çš„ï¼š
fileName := &amp;#34;/tmp/alert-history.txt&amp;#34; f, err := os.OpenFile(fileName, os.O_RDWR, 0644) if err != os.ErrNotExist { panic(fmt.Sprintf(&amp;#34;open file %s error: %s&amp;#34;, fileName, err)) } else { f, err = os.Create(fileName) if err != nil { panic(fmt.Sprintf(&amp;#34;create file %s error: %s&amp;#34;, fileName, err)) } } defer f.Close() // detect alarm 	// ...  // if alarm not in file 	// then send alarm and 	// write its hash to the file 	// .</description>
    </item>
    
    <item>
      <title>Golang-For-Loop</title>
      <link>https://wrfly.kfd.me/posts/golang-for-loop/</link>
      <pubDate>Sun, 25 Nov 2018 14:34:14 +0800</pubDate>
      
      <guid>https://wrfly.kfd.me/posts/golang-for-loop/</guid>
      <description>ğŸ˜€
Recently my colleague meets a problem with golang for loop. He ranged an array of User, wanted to filter some user and append them (use pointer to get their address) to another user array, but finally got an array contains the same user.
Some thing like this:
newUsers := []*User{} for _, u := range UserArray{ if checkFailed(u){ continue } newUsers = append(newUsers, &amp;amp;u) } The newUsers got the same user with different indexes.</description>
    </item>
    
    <item>
      <title>Gracefully-Shutdown</title>
      <link>https://wrfly.kfd.me/posts/gracefully-shutdown/</link>
      <pubDate>Wed, 03 Jan 2018 23:03:07 +0800</pubDate>
      
      <guid>https://wrfly.kfd.me/posts/gracefully-shutdown/</guid>
      <description>æ—¶é—´æ˜¯å®‡å®™å”¯ä¸€çš„èµ„æº &amp;mdash; æˆ‘
 å› ä¸ºä¸Šå‘¨å‡†å¤‡code reviewçš„æ—¶å€™é‡åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œå¤§å®¶ä¹Ÿç»™å‡ºäº†ä¸€äº›å»ºè®®ï¼Œå’Œimcomå“¥ä¹Ÿè¿›è¡Œäº†ä¸€ç•ªè®¨è®ºï¼Œäº†è§£äº†golangä¸­contextçš„ä¸€äº›ç”¨æ³•ï¼Œåœ¨è¿™é‡Œè®°å½•å¤‡ä»½ä¸€ä¸‹ï¼Œä¹Ÿå¸Œæœ›å¯¹åˆ«äººæœ‰æ‰€å¸®åŠ©ã€‚
é¦–å…ˆç®€å•çš„é˜è¿°ä¸€ä¸‹é—®é¢˜æ˜¯ä»€ä¹ˆã€‚golangç¼–ç¨‹ï¼Œç»å¸¸ä¼šgoå‡ºå»ä¸€äº›goroutineï¼ŒæŠ›å‡ºå»ä¸éš¾ï¼Œå…³é”®è¦çœ‹æ€ä¹ˆæ”¶å›æ¥ï¼Œå› ä¸ºç¨‹åºä¸ä»…æœ‰å¯åŠ¨ï¼Œè¿˜è¦æœ‰é€€å‡ºï¼Œä¸ç®¡æ˜¯æ­£å¸¸é€€å‡ºè¿˜æ˜¯éæ­£å¸¸é€€å‡ºï¼Œæ€»å¾—æœ‰ä¸€ä¸ªclean upçš„è¿‡ç¨‹ï¼Œä¸ç„¶å°±ä¼šå¯¼è‡´ç¨‹åºä¸å¯æ§ï¼Œå¼•å‘éæ­£å¸¸é€€å‡ºï¼Œæ•°æ®ä¸¢å¤±æˆ–è€…è„æ•°æ®ç­‰ä¸€äº›ä¹±ä¸ƒå…«ç³Ÿçš„é—®é¢˜ã€‚
æ‰€ä»¥æˆ‘ä»¬è¦åœ¨ç¨‹åºé€€å‡ºçš„æ—¶å€™å¯¹ç”³è¯·çš„èµ„æºè¿›è¡Œé‡Šæ”¾ï¼Œä¸»åŠ¨å…³é—­å·²ç»å»ºç«‹çš„è¿æ¥ï¼Œå®Œæˆæ­£åœ¨è¿›è¡Œçš„å·¥ä½œï¼Œç„¶åé€€å‡ºç¨‹åºã€‚
githubä¸Šæœ‰å¾ˆå¤šå…¬å¼€çš„è®©httpæœåŠ¡gracefulé€€å‡ºçš„libï¼Œå¥½åƒæŸäº›æ¡†æ¶ä¹Ÿæä¾›äº†gracefulstopçš„æ–¹æ³•ã€‚å…¶æœ¬è´¨å°±æ˜¯åœæ­¢æœåŠ¡ï¼Œå…³é—­ç«¯å£ï¼Œæ‹’ç»äº†æ–°æ¥çš„è¯·æ±‚ï¼Œç„¶åæŠŠæ‰‹å¤´æ­£åœ¨è¿›è¡Œçš„è¯·æ±‚å¤„ç†å®Œï¼Œæˆ–è€…è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´å¼ºåˆ¶ç»“æŸæ­£åœ¨è¿›è¡Œçš„è¯·æ±‚ï¼Œç„¶åserverå°±stopäº†ã€‚è¿™é‡Œæˆ‘ä¸è°ˆè®ºè¿™ä¸ªï¼Œå› ä¸ºæœ‰å¾ˆå¤šæ¡†æ¶éƒ½è‡ªå¸¦äº†è¿™ä¸ªåŠŸèƒ½ï¼Œè€Œä¸”ä¸é™äºhttpæœåŠ¡ã€‚
ä½†æœ‰ä¸ªä¸œè¥¿æ˜¯è¦å‚è€ƒçš„ï¼Œgolangä¸­çš„contextã€‚å†™è¿‡httpæœåŠ¡çš„äººéƒ½çŸ¥é“ï¼Œæ¯ä¸ªè¯·æ±‚çš„requestä¸­éƒ½å¸¦äº†ä¸€ä¸ªcontextï¼Œä¸€å¼€å§‹æˆ‘æ˜¯ä¸çŸ¥é“è¿™æ˜¯åšä»€ä¹ˆç”¨çš„ï¼Œä½†æ¯ä¸ªä¸œè¥¿éƒ½æœ‰å…¶ç”¨æ³•ï¼Œè¿™ä¸ªcontextçš„ç”¨æ³•å°±æ˜¯è®©serverç«¯å’Œclientè”ç³»èµ·æ¥çš„ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºçº½å¸¦ã€‚æœ€åŸºç¡€çš„ï¼Œæ¯”å¦‚clientå‘å‡ºäº†ä¸€ä¸ªè¯·æ±‚ï¼Œä½†æ˜¯ç”±äºæŸç§åŸå› ï¼ˆç½‘ç»œæ–­äº†ï¼Œé“¾æ¥ä¸¢äº†ï¼Œå®¢æˆ·ç«¯ä¸»åŠ¨å…³é—­äº†ï¼ŒCtrl+Cäº†ï¼‰ï¼Œè¿™ä¸ªè¿æ¥æ–­äº†ï¼Œé‚£ä¹ˆserverç«¯è¿˜è¦ç»§ç»­å¤„ç†ä¹ˆï¼Œè‚¯å®šä¸è¦äº†å˜›ï¼Œä¸ç„¶å‘ç»™è°ï¼Œç»™é¬¼å•Šï¼Œæ‰€ä»¥serverå°±è¦æ ¹æ®è¿™ä¸ªcontextè¿›è¡Œä¸‹ä¸€æ­¥å¤„ç†ï¼Œå¦‚æœcontextå·²ç»doneäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªè¯·æ±‚å°±å¯ä»¥ç›´æ¥returnäº†ã€‚
è¯´èµ·æ¥ä¼šå¾ˆæ¯ç‡¥ï¼Œçœ‹ä»£ç ï¼ˆè·Ÿä¸Šé¢è¯´çš„serveræ— å…³äº†å“ˆï¼Œæœ‰ç‚¹åï¼‰ï¼š
package main import ( &amp;#34;context&amp;#34; &amp;#34;fmt&amp;#34; &amp;#34;sync&amp;#34; &amp;#34;time&amp;#34; ) var wg sync.WaitGroup func main() { ctx, cancel := context.WithCancel(context.Background()) defer cancel() n := 3 wg.Add(n) for i := 0; i &amp;lt; n; i++ { go testContext(ctx) } time.Sleep(2100 * time.Millisecond) cancel() wg.Wait() } func testContext(ctx context.Context) { defer wg.Done() defer fmt.Println(&amp;#34;stop&amp;#34;) tk := time.NewTicker(time.Second) defer tk.Stop() for { select { case &amp;lt;-ctx.</description>
    </item>
    
  </channel>
</rss>